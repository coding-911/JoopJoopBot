# DART 데이터 수집 운영 가이드

이 문서는 JoopJoopBot의 DART 데이터 수집 작업(DAG)의 운영과 모니터링에 대해 설명합니다.

## DAG 구성 및 실행

JoopJoopBot은 다음과 같은 DAG들을 통해 DART 데이터를 수집합니다:

1. `fetch_dart_daily`: 일일 수집 DAG
   - 실행 주기: 매일 자정 (`0 0 * * *`)
   - 목적: 주요사항보고서, 경영진 변경 등 일간 공시 수집
   - 대상:
     - 주요사항보고서 (A004)
     - 경영진 변경 관련 공시
     - 기타 긴급 공시

2. `fetch_dart_weekly`: 주간 수집 DAG
   - 실행 주기: 매주 월요일 (`0 0 * * 1`)
   - 목적: 감사보고서 수집
   - 대상: 감사보고서 (A005)

3. `fetch_dart_monthly`: 월간 수집 DAG
   - 실행 주기: 매월 1일 (`0 0 1 * *`)
   - 목적: 정기보고서 수집
   - 대상:
     - 사업보고서 (A001)
     - 반기보고서 (A002)
     - 분기보고서 (A003)

4. `fetch_dart_historical`: 초기 데이터 수집
   - 실행 방식: 수동 실행
   - 목적: 과거 데이터 일괄 수집 (1년치)
   - 대상: 모든 상장기업의 전체 보고서
   - 진행 상황 추적:
     - Airflow Variable 사용
     - 수집 완료된 기업 목록 관리
     - 실패한 케이스 기록

## 수집 대상 보고서

### 1. 사업보고서 관련
- A001: 사업보고서
- A002: 반기보고서
- A003: 분기보고서

### 2. 주요 공시
- A004: 주요사항보고서
- A005: 감사보고서

### 3. 주요 경영 결정 (F001-F014)
- 영업양수도
- 자산양수도
- 유상증자
- 감자
- 전환사채 발행
- 신주인수권부사채 발행
- 교환사채 발행
- 회사분할/합병
- 자기주식 취득/처분
- 타법인 주식/출자증권 취득/처분

### 4. 지배구조 변경 (G001-G003)
- 최대주주 변경
- 경영권 변경
- 임원 변경

## 운영 모니터링

### 1. 수집 상태 모니터링
- 각 DAG별 독립적인 모니터링
- API 응답 상태
- 처리 속도
- 오류 발생 빈도
- 저장소 사용량

### 2. 알림 설정
- API 할당량 초과 시
- 처리 실패 시
- 중요 공시 발생 시

### 3. 에러 처리
- 재시도 메커니즘:
  - 최대 재시도 횟수: 3회
  - 재시도 간격: 설정 가능
- 로깅:
  - 상세한 에러 메시지 기록
  - 실패한 기업 코드 기록
  - 실패한 문서 정보 기록

## 운영 제약사항

### 1. API 사용량 제한
- 일일 API 호출 제한: 10,000회
- 분당 호출 제한: 100회
- DAG 실행 시간 분산 필요:
  - 일간/주간/월간 DAG 실행 시간 겹치지 않도록 조정
  - Historical DAG는 API 여유 시간대에 실행

### 2. 리소스 관리
- 디스크 사용량 모니터링
- API 호출 제한 고려
- 병렬 처리 수준 조정

### 3. 데이터 품질 관리
- 누락 데이터 확인
- 중복 수집 방지
- 메타데이터 정합성 검증
- 정정 공시 발생 시 기존 데이터 업데이트

### 4. 장애 대응
- API 장애 시 대응 방안
- 네트워크 문제 대응
- 저장소 문제 대응 